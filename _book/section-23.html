<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>第 4 章 弹性与半弹性 | 计量经济学与 Stata 的应用讲义</title>
  <meta name="description" content="第 4 章 弹性与半弹性 | 计量经济学与 Stata 的应用讲义" />
  <meta name="generator" content="bookdown 0.10.1 and GitBook 2.6.7" />

  <meta property="og:title" content="第 4 章 弹性与半弹性 | 计量经济学与 Stata 的应用讲义" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="第 4 章 弹性与半弹性 | 计量经济学与 Stata 的应用讲义" />
  <meta name="github-repo" content="czxa/econometrics-handouts" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="第 4 章 弹性与半弹性 | 计量经济学与 Stata 的应用讲义" />
  
  <meta name="twitter:description" content="第 4 章 弹性与半弹性 | 计量经济学与 Stata 的应用讲义" />
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="stata-3.html">
<link rel="next" href="stata-8.html">
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets/htmlwidgets.js"></script>
<link href="libs/leaflet/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet/leaflet.js"></script>
<link href="libs/leafletfix/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding/leaflet.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">计量经济学与Stata的应用讲义</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> 前言</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#section-1"><i class="fa fa-check"></i><b>1.1</b> 本书内容</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#section-2"><i class="fa fa-check"></i><b>1.2</b> 阅读本书之前的准备工作</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#section-3"><i class="fa fa-check"></i><b>1.3</b> 目标读者</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#section-4"><i class="fa fa-check"></i><b>1.4</b> 排版约定</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#section-5"><i class="fa fa-check"></i><b>1.5</b> 下载示例代码</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#section-6"><i class="fa fa-check"></i><b>1.6</b> 许可证</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#section-7"><i class="fa fa-check"></i><b>1.7</b> 读者反馈</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="stata-sublime-text3-.html"><a href="stata-sublime-text3-.html"><i class="fa fa-check"></i><b>2</b> Stata 安装与 Sublime Text3 配置教程</a><ul>
<li class="chapter" data-level="2.1" data-path="stata-sublime-text3-.html"><a href="stata-sublime-text3-.html#stata-"><i class="fa fa-check"></i><b>2.1</b> Stata 安装包获取</a></li>
<li class="chapter" data-level="2.2" data-path="stata-sublime-text3-.html"><a href="stata-sublime-text3-.html#stata14-"><i class="fa fa-check"></i><b>2.2</b> Stata14 的安装</a></li>
<li class="chapter" data-level="2.3" data-path="stata-sublime-text3-.html"><a href="stata-sublime-text3-.html#stata15-"><i class="fa fa-check"></i><b>2.3</b> Stata15 的安装</a></li>
<li class="chapter" data-level="2.4" data-path="stata-sublime-text3-.html"><a href="stata-sublime-text3-.html#stata--1"><i class="fa fa-check"></i><b>2.4</b> Stata 代码编辑器的配置</a></li>
<li class="chapter" data-level="2.5" data-path="stata-sublime-text3-.html"><a href="stata-sublime-text3-.html#shelldos-"><i class="fa fa-check"></i><b>2.5</b> 常用 shell/Dos 命令安装</a></li>
<li class="chapter" data-level="2.6" data-path="stata-sublime-text3-.html"><a href="stata-sublime-text3-.html#stata--2"><i class="fa fa-check"></i><b>2.6</b> Stata 更新</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="stata-3.html"><a href="stata-3.html"><i class="fa fa-check"></i><b>3</b> Stata 基础操作</a><ul>
<li class="chapter" data-level="3.1" data-path="stata-3.html"><a href="stata-3.html#stata--4"><i class="fa fa-check"></i><b>3.1</b> Stata 是什么</a></li>
<li class="chapter" data-level="3.2" data-path="stata-3.html"><a href="stata-3.html#stata--5"><i class="fa fa-check"></i><b>3.2</b> Stata 能做什么</a></li>
<li class="chapter" data-level="3.3" data-path="stata-3.html"><a href="stata-3.html#stata--6"><i class="fa fa-check"></i><b>3.3</b> Stata 基本操作</a></li>
<li class="chapter" data-level="3.4" data-path="stata-3.html"><a href="stata-3.html#section-15"><i class="fa fa-check"></i><b>3.4</b> 数据处理</a></li>
<li class="chapter" data-level="3.5" data-path="stata-3.html"><a href="stata-3.html#section-16"><i class="fa fa-check"></i><b>3.5</b> 数据导出</a></li>
<li class="chapter" data-level="3.6" data-path="stata-3.html"><a href="stata-3.html#section-17"><i class="fa fa-check"></i><b>3.6</b> 绘图</a></li>
<li class="chapter" data-level="3.7" data-path="stata-3.html"><a href="stata-3.html#section-18"><i class="fa fa-check"></i><b>3.7</b> 统计相关</a></li>
<li class="chapter" data-level="3.8" data-path="stata-3.html"><a href="stata-3.html#t-"><i class="fa fa-check"></i><b>3.8</b> t 检验、方差分析和因子分析</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="section-23.html"><a href="section-23.html"><i class="fa fa-check"></i><b>4</b> 弹性与半弹性</a><ul>
<li class="chapter" data-level="4.1" data-path="section-23.html"><a href="section-23.html#section-24"><i class="fa fa-check"></i><b>4.1</b> 弹性</a></li>
<li class="chapter" data-level="4.2" data-path="section-23.html"><a href="section-23.html#section-25"><i class="fa fa-check"></i><b>4.2</b> 半弹性</a></li>
<li class="chapter" data-level="4.3" data-path="section-23.html"><a href="section-23.html#section-28"><i class="fa fa-check"></i><b>4.3</b> 总结</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="stata-8.html"><a href="stata-8.html"><i class="fa fa-check"></i><b>5</b> Stata 网页表格爬取示例</a><ul>
<li class="chapter" data-level="5.1" data-path="stata-8.html"><a href="stata-8.html#section-29"><i class="fa fa-check"></i><b>5.1</b> 准备工作</a></li>
<li class="chapter" data-level="5.2" data-path="stata-8.html"><a href="stata-8.html#section-30"><i class="fa fa-check"></i><b>5.2</b> 网页分析</a></li>
<li class="chapter" data-level="5.3" data-path="stata-8.html"><a href="stata-8.html#section-31"><i class="fa fa-check"></i><b>5.3</b> 开始爬取</a></li>
<li class="chapter" data-level="5.4" data-path="stata-8.html"><a href="stata-8.html#section-36"><i class="fa fa-check"></i><b>5.4</b> 多页面爬取</a></li>
<li class="chapter" data-level="5.5" data-path="stata-8.html"><a href="stata-8.html#section-39"><i class="fa fa-check"></i><b>5.5</b> 数据呈现</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="stata-9.html"><a href="stata-9.html"><i class="fa fa-check"></i><b>6</b> Stata 修图与操作记录</a></li>
<li class="chapter" data-level="7" data-path="stata-docx-.html"><a href="stata-docx-.html"><i class="fa fa-check"></i><b>7</b> Stata 与 docx 文档的协同</a><ul>
<li class="chapter" data-level="7.1" data-path="stata-docx-.html"><a href="stata-docx-.html#section-40"><i class="fa fa-check"></i><b>7.1</b> 安装</a></li>
<li class="chapter" data-level="7.2" data-path="stata-docx-.html"><a href="stata-docx-.html#section-41"><i class="fa fa-check"></i><b>7.2</b> 使用</a></li>
<li class="chapter" data-level="7.3" data-path="stata-docx-.html"><a href="stata-docx-.html#section-42"><i class="fa fa-check"></i><b>7.3</b> 父母身高与子女身高</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="section-43.html"><a href="section-43.html"><i class="fa fa-check"></i><b>8</b> 习题讲解</a><ul>
<li class="chapter" data-level="8.1" data-path="section-43.html"><a href="section-43.html#section-44"><i class="fa fa-check"></i><b>8.1</b> 习题 6.5</a></li>
<li class="chapter" data-level="8.2" data-path="section-43.html"><a href="section-43.html#section-45"><i class="fa fa-check"></i><b>8.2</b> 习题 6.6</a></li>
<li class="chapter" data-level="8.3" data-path="section-43.html"><a href="section-43.html#section-46"><i class="fa fa-check"></i><b>8.3</b> 习题 7.2</a></li>
<li class="chapter" data-level="8.4" data-path="section-43.html"><a href="section-43.html#section-47"><i class="fa fa-check"></i><b>8.4</b> 习题 7.3</a></li>
<li class="chapter" data-level="8.5" data-path="section-43.html"><a href="section-43.html#section-48"><i class="fa fa-check"></i><b>8.5</b> 习题 9.4</a></li>
<li class="chapter" data-level="8.6" data-path="section-43.html"><a href="section-43.html#section-49"><i class="fa fa-check"></i><b>8.6</b> 习题 9.5</a></li>
<li class="chapter" data-level="8.7" data-path="section-43.html"><a href="section-43.html#section-50"><i class="fa fa-check"></i><b>8.7</b> 习题 10.5</a></li>
<li class="chapter" data-level="8.8" data-path="section-43.html"><a href="section-43.html#section-51"><i class="fa fa-check"></i><b>8.8</b> 习题 10.6</a></li>
<li class="chapter" data-level="8.9" data-path="section-43.html"><a href="section-43.html#section-52"><i class="fa fa-check"></i><b>8.9</b> 习题 12.3</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="section-53.html"><a href="section-53.html"><i class="fa fa-check"></i><b>9</b> 计量经济学课程的得分分布！</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">使用 bookdown 编排</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">计量经济学与 Stata 的应用讲义</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="section-23" class="section level1">
<h1><span class="header-section-number">第 4 章</span> 弹性与半弹性</h1>
<p>使用书上的 grilic_small.dta 数据集，考虑受教育年限对工资的影响。</p>
<div id="section-24" class="section level2">
<h2><span class="header-section-number">4.1</span> 弹性</h2>
<p>首先是弹性的表述，我们经常说这样一个词：“需求的价格弹性”，我们也很清楚它的意思是价格对需求的影响（而不是需求对价格的影响）。所以如果我们把他们换成数学语言，就是“y 的 x 弹性”(英文：The elasticity of y with respect to x)。计算公式如下：</p>
<p><span class="math display">\[\varepsilon  = \frac{\Delta y / y}{\Delta x / x}\]</span></p>
<p>即 y 的变化比例除以 x 的变化比例。关于弹性的表述非常绕，我们可以举个这样的例子：<span class="math inline">\(x = 100, \Delta x = 1, y = 100, \Delta y = 2\)</span>，那么<span class="math inline">\(\varepsilon = 2\)</span>。这样就说明，如果弹性为 2，那么其含义就是，<span class="math inline">\(x\)</span>变化<span class="math inline">\(1\%\)</span>，<span class="math inline">\(y\)</span>变化<span class="math inline">\(2\%\)</span>.</p>
<p>实际回归的时候如何求一个 y 的 x 弹性呢？我们可以继续把上面的公式变形一下：</p>
<p><span class="math display">\[\begin{align}
\varepsilon &amp; = \frac{\Delta y / y}{\Delta x / x} \\
&amp; = \frac{\partial y / y}{\partial x / x} \\
&amp; = \frac{\partial lny}{\partial lnx}
\end{align}\]</span></p>
<p>这就意味着如何想要求 <span class="math inline">\(y\)</span> 的 <span class="math inline">\(x\)</span> 弹性，我们需要求 <span class="math inline">\(lny\)</span> 对 <span class="math inline">\(lnx\)</span> 的偏导数。考虑工资的受教育年限弹性：</p>
<pre class="stata"><code>cuse grilic_small, clear web
* 或者
use http://czxa.top/cuse/g/grilic_small, clear
* 因为数据集里面已经对数工资变量，所以我们只对受教育年限变量取对数即可
gen lns = ln(s)
* 注意ln()函数和log()函数是等价的
* 回归lnw和lns
reg lnw lns

*&gt;       Source |       SS           df       MS      Number of obs   =        30
*&gt; -------------+----------------------------------   F(1, 28)        =     11.23
*&gt;        Model |  1.12395728         1  1.12395728   Prob &gt; F        =    0.0023
*&gt;     Residual |  2.80324396        28  .100115856   R-squared       =    0.2862
*&gt; -------------+----------------------------------   Adj R-squared   =    0.2607
*&gt;        Total |  3.92720124        29  .135420733   Root MSE        =    .31641
*&gt; ------------------------------------------------------------------------------
*&gt;          lnw |      Coef.   Std. Err.      t    P&gt;|t|     [95% Conf. Interval]
*&gt; -------------+----------------------------------------------------------------
*&gt;          lns |   1.271595   .3795118     3.35   0.002     .4942001    2.048989
*&gt;        _cons |   2.470437   .9933712     2.49   0.019     .4356081    4.505265
*&gt; ------------------------------------------------------------------------------</code></pre>
<p>可以看到，lnw 对 lns 的回归系数是 1.27，也就是 w 的 s 弹性，解释为：受教育年限每延长 1%，工资平均提高 1.27%。。很容易理解这里计算的是平均。我们经常需要计算 y 关于 x 在某个点的弹性（也就是说更多时候，弹性不是一个常数，而是关于 x 的函数）。</p>
<p>Stata 的 margins 命令可以用来计算 y 关于 x 在某个点的弹性：</p>
<pre class="stata"><code>* 首先我们需要生成工资变量，因为数据集里面只有工资对数变量
gen w = exp(lnw)
* 然后就 w 对 s 回归
reg w s

*&gt;       Source |       SS           df       MS      Number of obs   =        30
*&gt; -------------+----------------------------------   F(1, 28)        =     10.35
*&gt;        Model |  106091.987         1  106091.987   Prob &gt; F        =    0.0033
*&gt;     Residual |  287015.278        28  10250.5457   R-squared       =    0.2699
*&gt; -------------+----------------------------------   Adj R-squared   =    0.2438
*&gt;        Total |  393107.266        29   13555.423   Root MSE        =    101.24
*&gt; ------------------------------------------------------------------------------
*&gt;            w |      Coef.   Std. Err.      t    P&gt;|t|     [95% Conf. Interval]
*&gt; -------------+----------------------------------------------------------------
*&gt;            s |   28.26456   8.785661     3.22   0.003     10.26795    46.26117
*&gt;        _cons |   -41.4791   122.6431    -0.34   0.738    -292.7022     209.744
*&gt; ------------------------------------------------------------------------------</code></pre>
<p>我们也知道这个回归系数 28.26 的含义是受教育年限每延长一年，工资平均增加 28 块钱（币种可能是美元）。</p>
<p>然后我们可以使用 tabulate 命令查看变量 s 的频率频数分布表：</p>
<pre class="stata"><code>tab s

*&gt;   schooling |      Freq.     Percent        Cum.
*&gt; ------------+-----------------------------------
*&gt;          11 |          3       10.00       10.00
*&gt;          12 |         12       40.00       50.00
*&gt;          14 |          1        3.33       53.33
*&gt;          15 |          3       10.00       63.33
*&gt;          16 |         10       33.33       96.67
*&gt;          18 |          1        3.33      100.00
*&gt; ------------+-----------------------------------
*&gt;       Total |         30      100.00</code></pre>
<p>根据上表，我们可以看出 s 的取值为 11～18，所以下面我们求 w 关于 s 在每一点的弹性：</p>
<pre class="stata"><code>* margins必须在回归后才能使用
margins, eyex(s) at(s = (11(1)18))

*&gt; Conditional marginal effects                    Number of obs     =         30
*&gt; Model VCE    : OLS
*&gt; 
*&gt; Expression   : Linear prediction, predict()
*&gt; ey/ex w.r.t. : s
*&gt; 
*&gt; 1._at        : s               =          11
*&gt; 2._at        : s               =          12
*&gt; 3._at        : s               =          13
*&gt; 4._at        : s               =          14
*&gt; 5._at        : s               =          15
*&gt; 6._at        : s               =          16
*&gt; 7._at        : s               =          17
*&gt; 8._at        : s               =          18
*&gt; ------------------------------------------------------------------------------
*&gt;              |            Delta-method
*&gt;              |      ey/ex   Std. Err.      t    P&gt;|t|     [95% Conf. Interval]
*&gt; -------------+----------------------------------------------------------------
*&gt; s            |
*&gt;          _at |
*&gt;           1  |   1.153951    .470754     2.45   0.021     .1896548    2.118247
*&gt;           2  |   1.139334   .4206618     2.71   0.011     .2776474     2.00102
*&gt;           3  |   1.127252   .3801114     2.97   0.006     .3486291    1.905875
*&gt;           4  |   1.117098   .3466306     3.22   0.003     .4070576    1.827139
*&gt;           5  |   1.108445   .3185293     3.48   0.002     .4559675    1.760923
*&gt;           6  |   1.100983    .294614     3.74   0.001     .4974935    1.704472
*&gt;           7  |   1.094481   .2740186     3.99   0.000     .5331797    1.655783
*&gt;           8  |   1.088767   .2560998     4.25   0.000     .5641699    1.613363
*&gt; ------------------------------------------------------------------------------</code></pre>
<p>如果我们想把这些弹性绘制成关于 s 的图像该怎么做呢？
第一种是笨方法，把这些弹性直接手动复制粘贴下来：</p>
<pre class="stata"><code>clear
input s e
11 1.153951
12 1.139334
13 1.127252
14 1.117098
15 1.108445
16 1.100983
17 1.094481
18 1.088767
end
line e s, xti(受教育年限) ///
      yti(工资的受教育年限弹性) ///
      yla(, format(%6.2f))</code></pre>
<div class="figure" style="text-align: center"><span id="fig:wage123"></span>
<img src="assets/%E5%B7%A5%E8%B5%84%E7%9A%84%E5%8F%97%E6%95%99%E8%82%B2%E5%B9%B4%E9%99%90%E5%BC%B9%E6%80%A7.png" alt="工资的受教育年限弹性" width="80%" />
<p class="caption">
图 4.1: 工资的受教育年限弹性
</p>
</div>
<p>另外一种方法是直接利用返回值。很多 Stata 命令运行之后都会保留一些返回值，运行命令 <code>return list</code> 就可以查看，例如上面 margins 命令运行之后的返回值查看：</p>
<pre class="stata"><code>* 因为刚刚clear了，所以再重新运行一下前面的命令
cuse grilic_small.dta, c w
gen w = exp(lnw)
* qui 前缀可以隐藏运行结果
qui reg w s
qui margins, eyex(s) at(s = (11(1)18))
ret list

*&gt; scalars:
*&gt;               r(level) =  95
*&gt;                r(k_at) =  1
*&gt;                r(k_by) =  1
*&gt;           r(k_predict) =  1
*&gt;           r(k_margins) =  0
*&gt;                r(df_r) =  28
*&gt;                   r(N) =  30
*&gt; 
*&gt; macros:
*&gt;            r(mcmethod) : &quot;noadjust&quot;
*&gt;                 r(cmd) : &quot;margins&quot;
*&gt;             r(cmdline) : &quot;margins , eyex(s) at(s = (11(1)18))&quot;
*&gt;         r(est_cmdline) : &quot;regress w s&quot;
*&gt;             r(est_cmd) : &quot;regress&quot;
*&gt;          r(emptycells) : &quot;strict&quot;
*&gt;            r(atstats8) : &quot;values&quot;
*&gt;            r(atstats7) : &quot;values&quot;
*&gt;            r(atstats6) : &quot;values&quot;
*&gt;            r(atstats5) : &quot;values&quot;
*&gt;            r(atstats4) : &quot;values&quot;
*&gt;            r(atstats3) : &quot;values&quot;
*&gt;            r(atstats2) : &quot;values&quot;
*&gt;            r(atstats1) : &quot;values&quot;
*&gt;          r(continuous) : &quot;continuous&quot;
*&gt;         r(derivatives) : &quot;ey/ex&quot;
*&gt;               r(xvars) : &quot;s&quot;
*&gt;          r(expression) : &quot;predict()&quot;
*&gt;      r(predict1_label) : &quot;Linear prediction&quot;
*&gt;             r(vcetype) : &quot;Delta-method&quot;
*&gt;                 r(vce) : &quot;delta&quot;
*&gt;           r(model_vce) : &quot;ols&quot;
*&gt;               r(title) : &quot;Conditional marginal effects&quot;
*&gt; 
*&gt; matrices:
*&gt;               r(table) :  9 x 8
*&gt;           r(chainrule) :  1 x 3
*&gt;                  r(at) :  8 x 1
*&gt;                   r(V) :  8 x 8
*&gt;            r(Jacobian) :  8 x 2
*&gt;               r(error) :  1 x 8
*&gt;                   r(b) :  1 x 8
*&gt;                  r(_N) :  1 x 8</code></pre>
<p>对比前面的 margins 的运行结果，可以很容易的发现我们需要的东西在<code>r(table)</code>里面，是以矩阵的形式保存的。我们把它读出来：</p>
<pre class="stata"><code>* 首先把r(table)保存到矩阵e里面，矩阵生产使用matrix命令，简写为mat
mat e = r(table)

* 查看矩阵使用matrix list命令，简写为mat list
mat list e

*&gt; e[9,8]
*&gt;                 s:         s:         s:         s:         s:         s:         s:         s:
*&gt;                 1.         2.         3.         4.         5.         6.         7.         8.
*&gt;               _at        _at        _at        _at        _at        _at        _at        _at
*&gt;      b  1.1539507  1.1393339   1.127252  1.1170982  1.1084451  1.1009828  1.0944814  1.0887665
*&gt;     se  .47075402  .42066176  .38011143  .34663063  .31852928  .29461398  .27401865  .25609981
*&gt;      t  2.4512816  2.7084323  2.9655831  3.2227338  3.4798845  3.7370353   3.994186  4.2513367
*&gt; pvalue  .02073597  .01139796  .00611555  .00321455  .00166106  .00084655  .00042681  .00021346
*&gt;     ll  .18965477  .27764736  .34862905  .40705759  .45596746  .49749346  .53317969  .56416985
*&gt;     ul  2.1182466  2.0010205   1.905875  1.8271389  1.7609228  1.7044722  1.6557832  1.6133632
*&gt;     df         28         28         28         28         28         28         28         28
*&gt;   crit  2.0484071  2.0484071  2.0484071  2.0484071  2.0484071  2.0484071  2.0484071  2.0484071
*&gt;  eform          0          0          0          0          0          0          0          0</code></pre>
<p>我们可以设计一个小循环，实现创建弹性 e 和变量 s 的数据集：</p>
<pre class="stata"><code>* preserve和restore是一对命令，preserve可以预保存，当前数据集和各种变量，restore可以恢复preserve预保存的内容。也就是说preserve和restore之间的操作不会产生影响
preserve
* 只使用clear不会清除宏变量（例如上面的矩阵）
clear
set obs 8
gen e = .
gen s = .
forval i = 1/8{
      replace s = `i&#39; + 10
      replace e = e[1, `i&#39;]
}
line e s, xti(受教育年限) ///
      yti(工资的受教育年限弹性) ///
      yla(, format(%6.2f))
restore</code></pre>
</div>
<div id="section-25" class="section level2">
<h2><span class="header-section-number">4.2</span> 半弹性</h2>
<p>同样，我们可以这样定义 y 的 x 半弹性（The semielasticity of y with respect to x）：
<span class="math display">\[
semi\sim\varepsilon 1 = \frac{\partial y}{\partial lnx}
\]</span></p>
<p><span class="math display">\[
semi\sim\varepsilon 2 = \frac{\partial lny}{\partial x}
\]</span></p>
<div id="section-26" class="section level3">
<h3><span class="header-section-number">4.2.1</span> 第一种半弹性</h3>
<p>对于第一种半弹性：</p>
<p><span class="math display">\[\begin{align}
semi\sim\varepsilon 1 &amp; = \frac{\partial y}{\partial lnx} \\
&amp; = \frac{\partial y}{\partial x/x}
\end{align}\]</span></p>
<p>可以这么理解，<span class="math inline">\(x = 100, \partial x = 100, \partial y = 2, semi \sim \varepsilon 1 = 2\)</span>。即是说，半弹性为 2 的时候表示 x 增加 100%，y 增加 2 个单位。</p>
<p>如果我们想求工资关于受教育年限的半弹性：</p>
<pre class="stata"><code>cuse grilic_small, c w
gen lns = ln(s)
reg w lns

*&gt;       Source |       SS           df       MS      Number of obs   =        30
*&gt; -------------+----------------------------------   F(1, 28)        =     10.09
*&gt;        Model |  104136.237         1  104136.237   Prob &gt; F        =    0.0036
*&gt;     Residual |  288971.029        28  10320.3939   R-squared       =    0.2649
*&gt; -------------+----------------------------------   Adj R-squared   =    0.2387
*&gt;        Total |  393107.266        29   13555.423   Root MSE        =    101.59
*&gt; ------------------------------------------------------------------------------
*&gt;            w |      Coef.   Std. Err.      t    P&gt;|t|     [95% Conf. Interval]
*&gt; -------------+----------------------------------------------------------------
*&gt;          lns |   387.0569    121.849     3.18   0.004     137.4605    636.6532
*&gt;        _cons |  -662.8339   318.9395    -2.08   0.047    -1316.152   -9.516088
*&gt; ------------------------------------------------------------------------------</code></pre>
<p>回归结果为 387.0569。表示受教育年限翻一番，工资平均增加 387.0569 块钱。同样这个时候可以用 margins 命令求在受教育年限的每个点的半弹性，不过这个时候要用的选项是<code>dyex()</code>：</p>
<pre class="stata"><code>cuse grilic_small.dta, c
gen w = exp(lnw)
qui reg w s
qui margins, dyex(s) at(s = (11(1)18))
mat e = r(table)
clear
set obs 8
gen e = .
gen s = .
forval i = 1/8{
      replace s = `i&#39; + 10 in `i&#39;
      replace e = e[1, `i&#39;] in `i&#39;
}
line e s, xti(受教育年限) ///
      yti(工资的受教育年限半弹性) ///
      yla(, format(%6.2f))
gr export 工资的受教育年限半弹性.png, replace width(2400)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:wage456"></span>
<img src="assets/%E5%B7%A5%E8%B5%84%E7%9A%84%E5%8F%97%E6%95%99%E8%82%B2%E5%B9%B4%E9%99%90%E5%8D%8A%E5%BC%B9%E6%80%A7.png" alt="工资的受教育年限半弹性" width="80%" />
<p class="caption">
图 4.2: 工资的受教育年限半弹性
</p>
</div>
</div>
<div id="section-27" class="section level3">
<h3><span class="header-section-number">4.2.2</span> 第二种半弹性</h3>
<p>对于第二种半弹性：</p>
<p><span class="math display">\[\begin{align}
semi\sim\varepsilon 2 &amp;= \frac{\partial lny}{\partial x} \\
&amp; = \frac{\partial y/y}{\partial x}
\end{align}\]</span></p>
<p>可以这么理解，<span class="math inline">\(\partial x = 1, \partial y = 200, y =100, semi \sim \varepsilon 2 = 2\)</span>。即是说，半弹性为 2 的时候表示 x 增加 1，y 增加 200%。</p>
<p>这里求工资关于受教育年限的半弹性：</p>
<pre class="stata"><code>cuse grilic_small.dta, c w
reg lnw s

*&gt;       Source |       SS           df       MS      Number of obs   =        30
*&gt; -------------+----------------------------------   F(1, 28)        =     11.34
*&gt;        Model |  1.13168716         1  1.13168716   Prob &gt; F        =    0.0022
*&gt;     Residual |  2.79551408        28  .099839789   R-squared       =    0.2882
*&gt; -------------+----------------------------------   Adj R-squared   =    0.2627
*&gt;        Total |  3.92720124        29  .135420733   Root MSE        =    .31597
*&gt; ------------------------------------------------------------------------------
*&gt;          lnw |      Coef.   Std. Err.      t    P&gt;|t|     [95% Conf. Interval]
*&gt; -------------+----------------------------------------------------------------
*&gt;            s |   .0923133   .0274191     3.37   0.002     .0361478    .1484787
*&gt;        _cons |   4.519277   .3827556    11.81   0.000     3.735237    5.303316
*&gt; ------------------------------------------------------------------------------</code></pre>
<p>回归系数为 0.09，即使说，受教育年限每增加一年，工资平均增加 0.09%。
同样可以求受教育年限每个点上的半弹性，这个时候使用 <code>eydx()</code> 选项：</p>
<pre class="stata"><code>cuse grilic_small.dta, c
gen w = exp(lnw)
qui reg w s
qui margins, eydx(s) at(s = (11(1)18))
mat e = r(table)
clear
set obs 8
gen e = .
gen s = .
forval i = 1/8{
      replace s = `i&#39; + 10 in `i&#39;
      replace e = e[1, `i&#39;] in `i&#39;
}
line e s, xti(受教育年限) ///
      yti(工资的受教育年限半弹性) ///
      yla(, format(%6.2f))
gr export 工资的受教育年限半弹性2.png, replace width(2400)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:wage4562"></span>
<img src="assets/%E5%B7%A5%E8%B5%84%E7%9A%84%E5%8F%97%E6%95%99%E8%82%B2%E5%B9%B4%E9%99%90%E5%8D%8A%E5%BC%B9%E6%80%A72.png" alt="工资的受教育年限半弹性2" width="80%" />
<p class="caption">
图 4.3: 工资的受教育年限半弹性2
</p>
</div>
</div>
</div>
<div id="section-28" class="section level2">
<h2><span class="header-section-number">4.3</span> 总结</h2>
<p>最后可以用 Stata 帮助文件(margins 命令: dydx 选项)中的一个表格来总结弹性和半弹性：</p>
<p><img src="assets/dydx.png" /></p>

</div>
</div>
<div id="valine-thread"></div>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="//unpkg.com/valine/dist/Valine.min.js"></script>
<script>
    new Valine({
        el: '#valine-thread' ,
        notify: true,
        verify: false,
        app_id: 'HS0fE2GH92TyPjSpxeuEpr9P-gzGzoHsz',
        app_key: 'hyvGUifU6e34ODKmahBUtoN6',
        placeholder: '在这里评论～记得留下邮箱哈，这样有回复的时候会有邮件通知。',
        avatar: 'monsterid',
        avatar_cdn: 'https://gravatar.loli.net/avatar/',
        pageSize: '2'
    });
</script>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="stata-3.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="stata-8.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/czxa/econometrics-handouts/edit/master/03-elastic.Rmd",
"text": "编辑"
},
"history": {
"link": null,
"text": null
},
"download": ["econometrics-handouts.pdf"],
"toc": {
"collapse": "none"
},
"output_dir": "docs"
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
